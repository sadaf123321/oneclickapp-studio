<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover'>
    <title>Neon Dash</title>
    <script src='https://cdn.tailwindcss.com'></script>
    <style>
        body { margin: 0; overflow: hidden; background: #09090b; font-family: 'Inter', sans-serif; }
        #gameCanvas { display: block; touch-action: none; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class='h-[100dvh] flex flex-col items-center justify-center overflow-hidden'>

    <!-- UI Overlay -->
    <div id='ui-container' class='fixed inset-0 z-10 flex items-center justify-center p-6'>
        <!-- Start Screen -->
        <div id='start-screen' class='glass p-8 rounded-[2rem] text-center w-full max-w-sm'>
            <h1 class='text-4xl font-bold text-white mb-2 uppercase tracking-tighter'>Neon Dash</h1>
            <p class='text-zinc-400 mb-8'>গ্যাপ দিয়ে নিরাপদে পার হোন এবং ফিনিশ লাইনে পৌঁছান।</p>
            <button onclick='window.startGame()' class='w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold text-lg active:scale-95 transition-transform'>খেলা শুরু করুন</button>
        </div>

        <!-- Game Over Screen -->
        <div id='game-over-screen' class='hidden glass p-8 rounded-[2rem] text-center w-full max-w-sm'>
            <h1 class='text-4xl font-bold text-red-500 mb-2 uppercase'>গেম ওভার!</h1>
            <p class='text-zinc-400 mb-8'>আপনি বাধা স্পর্শ করেছেন।</p>
            <button onclick='window.startGame()' class='w-full py-4 bg-zinc-800 text-white rounded-2xl font-bold text-lg active:scale-95 transition-transform'>আবার চেষ্টা করুন</button>
        </div>

        <!-- Win Screen -->
        <div id='win-screen' class='hidden glass p-8 rounded-[2rem] text-center w-full max-w-sm'>
            <h1 class='text-4xl font-bold text-emerald-500 mb-2 uppercase'>অভিনন্দন!</h1>
            <p class='text-zinc-400 mb-8'>আপনি লেভেলটি সফলভাবে শেষ করেছেন।</p>
            <button onclick='window.startGame()' class='w-full py-4 bg-emerald-600 text-white rounded-2xl font-bold text-lg active:scale-95 transition-transform'>আবার খেলুন</button>
        </div>
    </div>

    <canvas id='gameCanvas'></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = 'START'; // START, PLAYING, OVER, WIN
        let animationId;
        
        const player = {
            x: 50,
            y: 0,
            size: 30,
            velocity: 0,
            gravity: 0.4,
            jump: -7,
            color: '#6366f1'
        };

        let obstacles = [];
        let frameCount = 0;
        let finishLineX = 5000; // Distance to win
        let currentDistance = 0;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            player.y = canvas.height / 2;
        }

        window.addEventListener('resize', resize);
        resize();

        function spawnObstacle() {
            const gapHeight = 180;
            const minObstacleHeight = 100;
            const availableSpace = canvas.height - gapHeight;
            const topHeight = Math.random() * (availableSpace - minObstacleHeight * 2) + minObstacleHeight;
            
            obstacles.push({
                x: canvas.width,
                topHeight: topHeight,
                bottomY: topHeight + gapHeight,
                width: 60,
                passed: false
            });
        }

        function handleInput() {
            if (gameState === 'PLAYING') {
                player.velocity = player.jump;
            }
        }

        window.addEventListener('mousedown', handleInput);
        window.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleInput();
        }, { passive: false });

        window.startGame = () => {
            gameState = 'PLAYING';
            player.y = canvas.height / 2;
            player.velocity = 0;
            obstacles = [];
            currentDistance = 0;
            frameCount = 0;
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-over-screen').classList.add('hidden');
            document.getElementById('win-screen').classList.add('hidden');
            
            if (animationId) cancelAnimationFrame(animationId);
            update();
        };

        function gameOver() {
            gameState = 'OVER';
            if (window.NativeBridge) window.NativeBridge.vibrate(100);
            document.getElementById('game-over-screen').classList.remove('hidden');
        }

        function winGame() {
            gameState = 'WIN';
            document.getElementById('win-screen').classList.remove('hidden');
        }

        function update() {
            if (gameState !== 'PLAYING') return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Player Physics
            player.velocity += player.gravity;
            player.y += player.velocity;
            currentDistance += 3;

            // Floor/Ceiling collision
            if (player.y < 0 || player.y + player.size > canvas.height) {
                gameOver();
            }

            // Obstacles
            if (frameCount % 90 === 0 && currentDistance < finishLineX - 1000) {
                spawnObstacle();
            }

            obstacles.forEach((obs, index) => {
                obs.x -= 3;

                // Draw Obstacles
                ctx.fillStyle = '#27272a';
                ctx.shadowBlur = 15;
                ctx.shadowColor = 'rgba(0,0,0,0.5)';
                
                // Top Pipe
                ctx.fillRect(obs.x, 0, obs.width, obs.topHeight);
                // Bottom Pipe
                ctx.fillRect(obs.x, obs.bottomY, obs.width, canvas.height - obs.bottomY);

                // Collision Detection
                if (
                    player.x < obs.x + obs.width &&
                    player.x + player.size > obs.x &&
                    (player.y < obs.topHeight || player.y + player.size > obs.bottomY)
                ) {
                    gameOver();
                }

                if (obs.x + obs.width < 0) {
                    obstacles.splice(index, 1);
                }
            });

            // Finish Line Logic
            if (currentDistance >= finishLineX) {
                winGame();
            }

            // Draw Finish Line Indicator
            const progress = (currentDistance / finishLineX) * 100;
            ctx.fillStyle = 'rgba(255,255,255,0.1)';
            ctx.fillRect(0, 0, canvas.width, 4);
            ctx.fillStyle = '#6366f1';
            ctx.fillRect(0, 0, (canvas.width * progress) / 100, 4);

            // Draw Player
            ctx.shadowBlur = 20;
            ctx.shadowColor = player.color;
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.roundRect(player.x, player.y, player.size, player.size, 8);
            ctx.fill();
            ctx.shadowBlur = 0;

            frameCount++;
            animationId = requestAnimationFrame(update);
        }

        // Initial Draw
        ctx.fillStyle = '#09090b';
        ctx.fillRect(0,0, canvas.width, canvas.height);
    </script>
</body>
</html>